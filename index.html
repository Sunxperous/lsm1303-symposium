<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>LSM1303 Group 34 (Grey Herons | AY2015/16 Sem II)</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/lsm1303.css"><!-- Personal CSS -->
    <link rel="stylesheet" href="lib/css/zenburn.css"><!-- Code syntax highlighting -->
    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="reveal">
      <div class="slides"><!-- Place <section> slides in this container -->
        <section id="scene1" data-background-video="videos/Sunshine.mov" data-background-video-loop>
          <h3 class="overlay-video">The case of the Grey Herons<br>(<em style="text-tranform: initial;">Ardea cinerea</em>)</h3>
          <p class="overlay-video">The effect of conspecifics on foraging efficiency of territorial feeders at Pasir Ris Park</p>
          <ul class="no-bullets overlay-video" style="font-size: 0.8em;">
           <li>Ang WeiLi (A0114600B)</li>
            <li>Han En Chou (A0081241U)</li>
            <li>Kong Li Xian Roxanne (A0116165L)</li>
            <li>Sun Wang Jun (A0110546R)</li>
            <li>Wong Si Ying Vinncent (A0111888X)</li>
          </ul>
        </section>

        <section id="scene2" data-background-video="videos/Handsome.mov">
        </section>
        
        <section id="scene2a" data-background-video="videos/Fluffy.mov">
          <!-- Maybe move scene2a video into scene2 -->
        </section>

        <section id="scene3">
          <p>
            <h2>Motivation of Study</h2>
            <span>Want to observe interactions with conspecifics</span>
          </p>
          <div class="fragment">
            <h2>Hypothesis</h2>
            <ol>
              <li>Shorter distance between conspecifics => Reduction in foraging efficiency</li>
              <li>Higher number of conspecifics => Reduction in foraging efficiency</li>
            </ol>
          </div>
        </section>

        <section id="scene4">
          <h2>Map</h2>
        </section>

        <section id="scene5">
          <h2>Tide Levels</h2>
          <div class="anything">
          <!--
          {
            "initialize": "function(container) {
              return tideLevels(container);
            }"
          }
          -->
          </div>
        </section>
        
        <section id="scene6">
          <h2>Equipment</h2>
          <table>
            <thead>
              <tr>
                <th>Camera model</th>
                <th>Sensor width /mm</th>
                <th>Sensor height /mm</th>
                <th>Image resolution /(w x h)px</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><img src="images/CanonEOSKissX5.png">
                  Canon EOS Kiss X5</td>
                <td>22.3</td>
                <td>14.9</td>
                <td>5184x3456<br>5184x2192</td>
              </tr>
              <tr>
                <td><img src="images/CanonEOS5dMarkII.png">
                  Canon EOS 5D Mark II</td>
                <td>36</td>
                <td>24</td>
                <td>5184x3456</td>
              </tr>
              <tr>
                <td><img src="images/EX-ZR50.png">
                  Casio EX-ZR50</td>
                <td>6.17</td>
                <td>4.55</td>
                <td>4608x3456</td>
              </tr>
              <tr>
                <td><img src="images/OppoR7s.png">
                  Oppo R7s</td>
                <td>4.69</td>
                <td>3.52</td>
                <td>4160x2340<br>6656x3744</td>
              </tr>
            </tbody>
          </table>
        </section>

        <section id="scene7" data-background="images/alloccurrence.png" data-background-size="700px" data-state="img-bottom-right">
          <h2>Sampling methods</h2>
          <p class="fragment"><em>All Occurrence Sampling</em> to record <strong>foraging counts</strong> by the herons in our observation area</p>
          <p class="fragment"><em>Scan Sampling</em> with actual time units to record the <strong>general position</strong> of the herons within the area
        </section>

        <section id="scene8" data-background-video="videos/Success.mov">
        </section>

        <section id="scene9" data-background-video="videos/Group.mov">
        </section>
        
        <section>
          <section id="scene10" data-background-video="videos/Measure.mov">
            <svg class="video-overlay">
            </svg>
          </section>
          <section id="scene10a-hidden">
            <h2><em>Magic</em> Formulas</h2>
            <p>$dist.\ from\ obj\ to\ camera$</p><p>$= \frac{focal\ length\ \> \times \> object\ height\ (mm) \> \times \> image\ height}{object\ height\ (px) \> \times \> sensor\ height}$</p>
            <br>
            <p>$x = \frac{dist.\ btwn\ objects\ (px) \> \times \> sensor\ width \> \times \> dist.\ from\ obj\ to\ camera}{focal\ length \> \times \> image\ width}$</p>
          </section>
        </section>

        <section id="scene11">
          <h2>Results</h2>
          <div class="anything">
          <!--
          {
            "initialize": "function(container) {
              return distToEfficiencyGraph(container);
            }"
          }
          -->
          </div>
        </section>

        <section id="scene11a">
          <h2>Results</h2>
          <div class="anything">
          <!--
          {
            "initialize": "function(container) {
              return numberToEfficiencyGraph(container);
            }"
          }
          -->
          </div>
        </section>

        <section id="scene12">
        </section>

        <section id="scene12a" data-background-video="videos/Exciting%20first.mov" data-background-video-loop>
        </section>

        <section id="scene12b">
        </section>

        <section id="scene12c" data-background-video="videos/Exciting%20second.mov" data-background-video-loop>
        </section>

        <section id="scene13" data-background-video="videos/Pair.mov">
        </section>

        <section id="scene14" data-background-video="videos/Failure.mov">
        </section>

        <section id="scene15">
          <h2>Limitations</h2>
          <ul>
            <li>Distance is measured using approximation, with uncertainty of about 1m</li>
            <li>Sunlight reflected off water may affect foraging efficiency</li>
            <li>Presence of animals like turtles, monitor lizard and other birds</li>
          </ul>
        </section>

        <section id="scene15a" data-background-video="videos/Kingfisher.mov" data-background-video-loop>
        </section>

        <section id="scene16">
          <p>These results suggest that the presence of conspecifics adversely affects foraging efficiency, although we acknowledge that our study is limited by other factors</p>
        </section>

        <section id="scene17">
          <small>Video collage</small>
        </section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="lib/js/d3.min.js"></script>
    <script src="js/reveal.js"></script>
    <script>
      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        width: 800,
        height: 600,

        transition: 'slide', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/math/math.js', async: true },
          { src: 'plugin/anything/anything.js' },
        ],

        anything: [
          {
            className: 'anything',
            initialize: function(container, options) {
              if (options && options.initialize) {
                options.initialize(container);
              }
            }
          }
        ]

      });

			// http://stackoverflow.com/a/10284006/559119
      // e.g. [[1, 11], [2, 22]] into [[1, 2], [11, 22]]
			function zip(arrays) {
				return arrays[0].map(function(_,i) {
					return arrays.map(function(array) { return array[i] });
				});
			}
      
      function distToEfficiencyGraph(container) {
        var width = 800,  // Width of <svg>.
            height = 500,  // Height of <svg>.
            padding = {top: 20, right: 50, bottom: 100, left: 100};  // Padding used for elements in <svg>.
            radius = 5;

        // Dataset.
        var x = [21.7, 23, 30.5, 12.87, 9.05, 90, 100, 40.94, 49.42, 46.94, 16.21, 15.92, 4.29],
            y = [0, 0, 6.3, 0, 0, 33.3, 50, 50, 0, 6.7, 12.5, 3.8, 2.1];
        var data = zip([x, y]);
        data = data.sort(function(a, b) {
          if (a[0] === b[0]) { return 0; }
          return (a[0] < b[0]) ? -1 : 1;
        });

        // For mapping the original values to coordinates.
        var xAxis = d3.scale.linear().domain([0, 120]).range([0 + padding.left, width - padding.right]),
            yAxis = d3.scale.linear().domain([60, 0]).range([0 + padding.top, height - padding.bottom]);

        // Remove and append new <svg>.
        d3.select(container).selectAll('svg').remove();
        var svg = d3.select(container)
          .append('svg')
          .attr('width', width)
          .attr('height', height);

        // Draw x-axis and y-axis.
        var xAxisLine = svg.append('g')
          .call(d3.svg.axis().scale(xAxis).ticks(120 / 20).orient('bottom'))
          .attr('class', 'axis')
          .attr('transform', 'translate(0, ' + (height - padding.bottom) + ')')
          .append('text')
            .text('average distance between herons /m')
            .attr('x', width / 2)
            .attr('y', 70)
            .attr('text-anchor', 'middle');

        var yAxisLine = svg.append('g')
          .call(d3.svg.axis().scale(yAxis).ticks(60 / 10).orient('left'))
          .attr('class', 'axis')
          .attr('transform', 'translate(' + padding.left + ', 0)')
          .append('text')
            .text('foraging efficiency /%')
            .attr('x', -60)
            .attr('y', (height - padding.bottom) / 2)
            .attr('text-anchor', 'middle')
            .attr('transform', 'rotate(-90, -60, '+ (height - padding.bottom) / 2 + ')');

        // Draw circles.
        var animationDelay = 100;
        svg.selectAll('circle')  // Select all circles, and add data.
          .data(data)
          .enter()
          .append('circle')  // For each data, append a circle.
            .transition()
              .delay(function(d, i) { return i * animationDelay; })  // Delay append in ms.
              .duration(1000)  // Animation duration in ms.
            .attr('fill', 'white')
            .attr('cx', function(d) { return xAxis(d[0]); })  // x-coordinate.
            .attr('cy', function(d) { return yAxis(d[1]); })  // y-coordinate.
            .attr('r', radius);

        // Draw line.
        svg.append('line')
          .transition()
            .delay(data.length / 2 * animationDelay)
          .attr('x1', xAxis(8.0434)).attr('y1', yAxis(0))
          .attr('x2', xAxis(120)).attr('y2', yAxis(0.515 * 100))
          .attr('stroke', 'white')
          .attr('stroke-width', radius)
          .attr('class', 'best-fit');
      };

      function numberToEfficiencyGraph(container) {
        var width = 800,  // Width of <svg>.
            height = 500,  // Height of <svg>.
            padding = {top: 20, right: 50, bottom: 100, left: 100};  // Padding used for elements in <svg>.
            radius = 5;

        // Dataset.
        var x = [1, 3, 4, 5, 8, 9],
            y = [50, 68, 5, 4, 0, 13];
        var data = zip([x, y]);
        data = data.sort(function(a, b) {
          if (a[0] === b[0]) { return 0; }
          return (a[0] < b[0]) ? -1 : 1;
        });

        // For mapping the original values to coordinates.
        var xAxis = d3.scale.linear().domain([0, 10]).range([0 + padding.left, width - padding.right]),
            yAxis = d3.scale.linear().domain([80, 0]).range([0 + padding.top, height - padding.bottom]);

        // Remove and append new <svg>.
        d3.select(container).selectAll('svg').remove();
        var svg = d3.select(container)
          .append('svg')
          .attr('width', width)
          .attr('height', height);

        // Draw x-axis and y-axis.
        var xAxisLine = svg.append('g')
          .call(d3.svg.axis().scale(xAxis).ticks(10 / 1).orient('bottom'))
          .attr('class', 'axis')
          .attr('transform', 'translate(0, ' + (height - padding.bottom) + ')')
          .append('text')
            .text('average number of herons')
            .attr('x', width / 2)
            .attr('y', 70)
            .attr('text-anchor', 'middle');

        var yAxisLine = svg.append('g')
          .call(d3.svg.axis().scale(yAxis).ticks(80 / 10).orient('left'))
          .attr('class', 'axis')
          .attr('transform', 'translate(' + padding.left + ', 0)')
          .append('text')
            .text('foraging efficiency /%')
            .attr('x', -60)
            .attr('y', (height - padding.bottom) / 2)
            .attr('text-anchor', 'middle')
            .attr('transform', 'rotate(-90, -60, '+ (height - padding.bottom) / 2 + ')');

        // Draw circles.
        var animationDelay = 200;
        svg.selectAll('circle')  // Select all circles, and add data.
          .data(data)
          .enter()
          .append('circle')  // For each data, append a circle.
            .transition()
              .delay(function(d, i) { return i * animationDelay; })  // Delay append in ms.
              .duration(1000)  // Animation duration in ms.
            .attr('fill', 'white')
            .attr('cx', function(d) { return xAxis(d[0]); })  // x-coordinate.
            .attr('cy', function(d) { return yAxis(d[1]); })  // y-coordinate.
            .attr('r', radius);

        // Draw line.
        svg.append('line')
          .transition()
          .attr('x1', xAxis(0)).attr('y1', yAxis(0.546 * 100))
          .attr('x2', xAxis(8.667)).attr('y2', yAxis(0))
          .attr('stroke', 'white')
          .attr('stroke-width', radius)
          .attr('class', 'best-fit');
      }

      function tideLevels(container) {
        var width = 800,  // Width of <svg>.
            height = 500,  // Height of <svg>.
            padding = {top: 20, right: 50, bottom: 100, left: 120};  // Padding used for elements in <svg>.
            radius = 3;

        // Dataset.
        var data = [
          ['', [[0], []]],
          ['26 Feb', [[7*60 + 50, 70], [9*60 + 40, 150], [7*60 + 25, 70]], '0.7m @ 7:25'],
          ['28 Feb', [[7*60 + 25, 100], [10*60 + 45, 150], [8*60 + 25, 70]], '0.7m @ 8:25'],
          ['13 Mar', [[7*60 + 10, 100], [10*60 + 0, 150], [8*60 + 15, 30]], '0.3m @ 8:15'],
          ['16 Mar', [[10*60 + 0, 100], [11*60 + 30, 100], [10*60 + 55, 60]], '0.6m @ 10:55'],
          ['20 Mar', [[14*60 + 0, 150], [16*60 + 30, 60], [16*60 + 15, 50]], '0.5m @ 16:15'],
          [' ', [[0], []]]
        ];

        // For mapping the original values to coordinates.
        var xAxis = d3.scale.linear().domain([7*60, 17*60]).range([0 + padding.left, width - padding.right]),
            yAxis = d3.scale.ordinal()
              .domain(data.map(function(x) { return x[0]; }))
              .rangePoints([height - padding.bottom, 0 + padding.top]);

        var tideHeight = (height - padding.bottom - padding.top) / (data.length - 1);
        var tideAxis = d3.scale.linear().domain([30, 150]).range([tideHeight, 0]);

        // Remove and append new <svg>.
        d3.select(container).selectAll('svg').remove();
        var svg = d3.select(container)
          .append('svg')
          .attr('width', width)
          .attr('height', height);

        // Draw x-axis and y-axis.
        var xAxisLine = svg.append('g')
          .call(d3.svg.axis()
              .scale(xAxis)
              .tickValues([420, 480, 540, 600, 660, 720, 780, 840, 900, 960, 1020])
              .tickFormat(function(d) { return (d / 60) + ''; })
              .orient('bottom'))
          .attr('class', 'axis')
          .attr('transform', 'translate(0, ' + (height - padding.bottom) + ')')
          .append('text')
            .text('time /:00')
            .attr('x', width / 2)
            .attr('y', 70)
            .attr('text-anchor', 'middle');

        var yAxisLine = svg.append('g')
          .call(d3.svg.axis().scale(yAxis).orient('left'))
          .attr('class', 'axis')
          .attr('transform', 'translate(' + padding.left + ', 0)');

        // Draw tide lines.
        var line = d3.svg.line()
          .interpolate('basis')
          .x(function(d, i) { return xAxis(d[0]); })
          .y(function(d, i) { return tideAxis(d[1]); })

        function sortAndSmoothen(c) {
          c = c.sort(function(a, b) {
            return a[0] < b[0];
          });
          c.splice(1, 0, [(c[0][0] + c[1][0]) / 2, c[0][1]]);
          c.splice(3, 0, [(c[2][0] + c[3][0]) / 2, c[3][1]]);
          return c;
        }

        var distAway = 90;
        data.forEach(function(item, i) {
          var g = svg.append('g')
            .attr('transform', 'translate(0, ' + i * tideHeight + ')')
          if (item[1][0][0] !== 0) {
            var path = g.append('path')
              .attr('d', line(sortAndSmoothen(item[1])))
              .attr('fill', 'none')
              .attr('stroke', 'blue')
              .attr('stroke-width', 8);
            var midPoint = item[1][2][0];
            if (midPoint > 13*60) {
              var cx = xAxis(item[1][4][0]) - distAway;
            } else {
              var cx = xAxis(item[1][0][0]) + distAway; 
            }
            g.append('text')
              .text(item[2])
              .attr('text-anchor', 'middle')
              .attr('transform', 'translate(' + cx + ', ' + tideHeight / 2 + ')');
          }
        });
      }

      Reveal.addEventListener('slidechanged', function(event) {
        if (event.currentSlide.id === 'scene5') {
          tideLevels(d3.select(event.currentSlide).select('.anything')[0][0]);
        }
        if (event.currentSlide.id === 'scene11') {
          distToEfficiencyGraph(d3.select(event.currentSlide).select('.anything')[0][0]);
        }
        if (event.currentSlide.id === 'scene11a') {
          numberToEfficiencyGraph(d3.select(event.currentSlide).select('.anything')[0][0]);
        }
      });
    </script>
  </body>
</html>
