<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>LSM1303 Group 34 (Grey Herons | AY2015/16 Sem II)</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/lsm1303.css"><!-- Personal CSS -->
    <link rel="stylesheet" href="lib/css/zenburn.css"><!-- Code syntax highlighting -->
    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="reveal">
      <div class="slides"><!-- Place <section> slides in this container -->
        <section id="scene1">
          <video class="stretch video-to-background" data-src="videos/Sunshine.mov" loop data-autoplay></video>
          <div style="position: absolute; top: 180px;">
            <div style="display: block; text-align: left; margin-bottom: 28px;">
              <ul class="no-bullets overlay-video" style="font-size: 0.5em; margin-left: 0;">
                <li>Ang Weili (A0114600B)</li>
                <li>Han En Chou (A0081241U)</li>
                <li>Kong Li Xian Roxanne (A0116165L)</li>
                <li>Sun Wang Jun (A0110546R)</li>
                <li>Wong Si Ying Vinncent (A0111888X)</li>
              </ul>
            </div>
            <h3 class="overlay-video"  style="text-align: left; margin: 0;">The case of the Grey Herons<br>
              <em style="text-transform: initial;">Ardea cinerea</em></h3>
            <p class="overlay-video" style="text-align: right; font-size: 0.9em; line-height: 1.2em; margin: 0;">The effect of conspecifics on foraging efficiency of territorial feeders at Pasir Ris Park</p>
          </div>
        </section>

        <section id="scene2">
          <video class="stretch" data-src="videos/Handsome.mov" data-autoplay></video>
        </section>
        
        <section id="scene2a">
          <video class="stretch" data-src="videos/Fluffy.mov" data-autoplay></video>
        </section>

        <section id="scene2b" style="height: 100%">
          <img src="images/Juvenile.jpg" style="top: 30%; left: 45%; transform: scale(1.4) rotate(10deg);">
          <img src="images/Adult.jpg" style="top: 10%; left: 5%; transform: scale(1.2) rotate(-10deg);">
        </section>

        <section id="scene3" class="margin">
          <p>
            <h2>Motivation of Study</h2>
            <span>Want to observe interactions with conspecifics</span>
          </p>
          <div class="fragment">
            <h2>Hypothesis</h2>
            <ol>
              <li>Shorter distance between conspecifics => Reduction in foraging efficiency</li>
              <li>Higher number of conspecifics => Reduction in foraging efficiency</li>
            </ol>
          </div>
        </section>

        <section id="scene4" class="has-svg-overlay">
          <video class="stretch" data-src="videos/Map.mp4" data-autoplay></video>
          <svg class="svg-overlay">
            <marker xmlns="http://www.w3.org/2000/svg" id="triangle" viewBox="0 0 10 10" refX="0" refY="5" markerUnits="strokeWidth" markerWidth="4" markerHeight="3" orient="auto">
              <path d="M 0 0 L 10 5 L 0 10 z"/>
            </marker>
            <g style="transition-delay: 3s">
            <line x1="42.5%" x2="43.75%" y1="87%" y2="74%" marker-end=url(#triangle)></line>
            <text x="35%" y="79.5%">100m</text>
            <line x1="44%" x2="48.5%" y1="72%" y2="73.5%" marker-end=url(#triangle)></line>
            <text x="45%" y="70%">50m</text>
            </g>
            <g style="transition-delay: 4s">
            <line x2="48%" x1="49%" y2="18%" y1="6%" marker-end=url(#triangle)></line>
            <text x="40%" y="14%">100m</text>
            <line x1="48%" x2="55%" y1="20.5%" y2="22%" marker-end=url(#triangle)></line>
            <text x="48%" y="27%">100m</text>
            </g>
            <g style="transition-delay: 5s">
            <line x2="58%" x1="60%" y2="20%" y1="8%" marker-end=url(#triangle)></line>
            <line x1="57.75%" x2="71%" y1="22.5%" y2="27%" marker-end=url(#triangle)></line>
            <text x="60%" y="30%">200m</text>
            </g>
          </svg>
        </section>

        <section id="scene5">
          <h2>Tide Levels</h2>
          <div class="anything">
          <!--
          {
            "initialize": "function(container) {
              return tideLevels(container);
            }"
          }
          -->
          </div>
        </section>
        
        <section id="scene6">
          <h2>Equipment</h2>
          <table>
            <thead>
              <tr>
                <th>Camera model</th>
                <th>Sensor width /mm</th>
                <th>Sensor height /mm</th>
                <th>Image resolution /(w x h)px</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><img src="images/CanonEOSKissX5.png">
                  Canon EOS Kiss X5</td>
                <td>22.3</td>
                <td>14.9</td>
                <td>5184x3456<br>5184x2192</td>
              </tr>
              <tr>
                <td><img src="images/CanonEOS5dMarkII.png">
                  Canon EOS 5D Mark II</td>
                <td>36</td>
                <td>24</td>
                <td>5184x3456</td>
              </tr>
              <tr>
                <td><img src="images/EX-ZR50.png">
                  Casio EX-ZR50</td>
                <td>6.17</td>
                <td>4.55</td>
                <td>4608x3456</td>
              </tr>
              <tr>
                <td><img src="images/OppoR7s.png">
                  Oppo R7s</td>
                <td>4.69</td>
                <td>3.52</td>
                <td>4160x2340<br>6656x3744</td>
              </tr>
            </tbody>
          </table>
        </section>

        <section id="scene7" class="margin" data-background="images/alloccurrence.png" data-background-size="700px" data-state="img-bottom-right">
          <h2>Sampling methods</h2>
          <p class="fragment"><em>All Occurrence Sampling</em> to record <strong>foraging counts</strong> by the herons in our observation area</p>
          <p class="fragment"><em>Scan Sampling</em> with actual time units to record the <strong>general position</strong> of the herons within the area
        </section>

        <section id="scene8">
          <video class="stretch" data-src="videos/Success.mov" data-autoplay></video>
        </section>

        <section>
          <section id="scene9">
            <div class="anything" style="position: absolute; width: 100%; height: 100%; left: 0; top: 0;">
            <!--
            {
              "initialize": "function(container) {
                return drawDistanceLine(container);
              }"
            }
            -->
            </div>
            <video class="stretch" data-src="videos/Measure.mov" data-autoplay></video>
          </section>
          <section id="scene9a-hidden">
            <h2><em>Magic</em> Formulas</h2>
            <p>$dist.\ from\ obj\ to\ camera$</p><p>$= \frac{focal\ length\ \> \times \> object\ height\ (mm) \> \times \> image\ height}{object\ height\ (px) \> \times \> sensor\ height}$</p>
            <br>
            <p>$x = \frac{dist.\ btwn\ objects\ (px) \> \times \> sensor\ width \> \times \> dist.\ from\ obj\ to\ camera}{focal\ length \> \times \> image\ width}$</p>
          </section>
        </section>

        <section id="scene10" class="has-svg-overlay">
          <video class="stretch" data-src="videos/Group.mov" data-autoplay></video>
          <svg class="svg-overlay">
            <circle cx="36%" cy="40%" r="6%" style="animation-delay: 1s">
            </circle>
            <circle cx="48%" cy="48%" r="6%" style="animation-delay: 1.5s">
            </circle>
            <circle cx="62%" cy="39%" r="6%" style="animation-delay: 2s">
            </circle>
            <circle cx="64%" cy="30%" r="6%" style="animation-delay: 2.5s">
            </circle>
          </svg>
        </section>

        <section id="scene11">
          <h2>Results</h2>
          <div class="anything">
          <!--
          {
            "initialize": "function(container) {
              return distToEfficiencyGraph(container);
            }"
          }
          -->
          </div>
          <i class="fragment" data-slide-id="scene11"></i>
        </section>

        <section id="scene11a">
          <h2>Results</h2>
          <div class="anything">
          <!--
          {
            "initialize": "function(container) {
              return numberToEfficiencyGraph(container);
            }"
          }
          -->
          </div>
          <i class="fragment" data-slide-id="scene11a"></i>
        </section>

        <section id="scene12" class="margin">
          <h2>Literature Review</h2>
          <small>Cook, D. C. (1978). Grey Herons Ardea cinerea holding<br>feeding territories on the Ythan Estuary. Bird study, 25(1), 11-16.</small>
          <p>"Usually individuals are well spaced out along the 8km stretch of estuary"</p>
          <p>"Aggressive displays were commonly seen among foraging Grey Herons"</p>
        </section>

        <section id="scene12a">
          <video class="stretch" data-src="videos/Exciting%20First.mov" data-autoplay></video>
        </section>

        <section id="scene12b">
          <video class="stretch" data-src="videos/Exciting%20second.mov" data-autoplay></video>
        </section>

        <section id="scene12c" class="margin">
          <h2>Literature Review</h2>
          <p><small>Cook, D. C. (1978). Grey Herons Ardea cinerea holding<br>feeding territories on the Ythan Estuary. Bird study, 25(1), 11-16.</small></p>
          <p><small>Snow, D. W.; Perrins, C. M. 1998. The Birds of the Western Palearctic vol. 1:<br>Non-Passerines. Oxford University Press, Oxford.</small></p>
          <p>"The species is typically a solitary feeder but at abundant temporary food sources, or where available feeding areas are restricted, large congregations may occur”</p>
        </section>

        <section id="scene13">
          <video class="stretch" data-src="videos/Pair.mov" data-autoplay></video>
        </section>

        <section id="scene14">
          <video class="stretch" data-src="videos/Failure.mov" data-autoplay></video>
        </section>

        <section id="scene15" class="margin">
          <h2>Limitations</h2>
          <ul>
            <li>Distance is measured using approximation, with uncertainty of about 1m</li>
            <li>Sunlight reflected off water may affect foraging efficiency</li>
            <li>Presence of animals like turtles, monitor lizard and other birds</li>
          </ul>
        </section>

        <section id="scene15a">
          <video class="stretch" data-src="videos/Kingfisher.mov" data-autoplay></video>
        </section>

        <section id="scene16" class="margin">
          <h2>Hypothesis</h2>
          <ol>
            <li>Shorter distance between conspecifics => Reduction in foraging efficiency</li>
            <li>Higher number of conspecifics => Reduction in foraging efficiency</li>
          </ol>
          <h2>Findings</h2>
          <p>These results suggest that the presence of conspecifics adversely affects foraging efficiency, although we acknowledge that our study is limited by other factors</p>
        </section>

        <section id="scene17">
          <small>Video collage</small>
        </section>

        <section id="scene18">
          <h2>References</h2>
          <ol>
            <li>Grey Herons Ardea cinerea holding Feeding Territories on the Ythan Estuary (D. C. Cook, 1978)</li>
            <li>TERRITORIAL FEEDING AND COLONIAL BREEDING ARE NOT MUTUALLY EXCLUSIVE: THE CASE OF THE GREY HERON (ARDEA CINEREA) (1989, L. Marion)</li>
            <li>Foraging Behaviour and Food of Grey Herons Ardea cinerea on the Ythan Estuary (David C. Cook)</li>
            <li>Snow and Perrins 1998, Kushlan and Hancock 2005</li>
          </ol>
        </section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="lib/js/d3.min.js"></script>
    <script src="js/reveal.js"></script>
    <script>
      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: false,

        width: 1024,
        height: 768,

        margin: 0,

        transition: 'slide', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/math/math.js', async: true },
          { src: 'plugin/anything/anything.js' },
        ],

        anything: [
          {
            className: 'anything',
            initialize: function(container, options) {
              if (options && options.initialize) {
                options.initialize(container);
              }
            }
          }
        ]

      });

			// http://stackoverflow.com/a/10284006/559119
      // e.g. [[1, 11], [2, 22]] into [[1, 2], [11, 22]]
			function zip(arrays) {
				return arrays[0].map(function(_,i) {
					return arrays.map(function(array) { return array[i] });
				});
			}
      
      function distToEfficiencyGraph(container, plotAndDraw) {
        var width = 800,  // Width of <svg>.
            height = 500,  // Height of <svg>.
            padding = {top: 20, right: 50, bottom: 100, left: 100};  // Padding used for elements in <svg>.
            radius = 5;

        // Dataset.
        var x = [21.7, 23, 30.5, 12.87, 9.05, 90, 100, 40.94, 49.42, 46.94, 16.21, 15.92, 4.29],
            y = [0, 0, 6.3, 0, 0, 33.3, 50, 50, 0, 6.7, 12.5, 3.8, 2.1];
        var data = zip([x, y]);
        data = data.sort(function(a, b) {
          if (a[0] === b[0]) { return 0; }
          return (a[0] < b[0]) ? -1 : 1;
        });

        // For mapping the original values to coordinates.
        var xAxis = d3.scale.linear().domain([0, 120]).range([0 + padding.left, width - padding.right]),
            yAxis = d3.scale.linear().domain([60, 0]).range([0 + padding.top, height - padding.bottom]);

        // Remove and append new <svg>.
        d3.select(container).selectAll('svg').remove();
        var svg = d3.select(container)
          .append('svg')
          .attr('width', width)
          .attr('height', height);

        // Draw x-axis and y-axis.
        var xAxisLine = svg.append('g')
          .call(d3.svg.axis().scale(xAxis).ticks(120 / 20).orient('bottom'))
          .attr('class', 'axis')
          .attr('transform', 'translate(0, ' + (height - padding.bottom) + ')')
          .append('text')
            .text('average distance between herons /m')
            .attr('x', width / 2)
            .attr('y', 70)
            .attr('text-anchor', 'middle');

        var yAxisLine = svg.append('g')
          .call(d3.svg.axis().scale(yAxis).ticks(60 / 10).orient('left'))
          .attr('class', 'axis')
          .attr('transform', 'translate(' + padding.left + ', 0)')
          .append('text')
            .text('foraging efficiency /%')
            .attr('x', -60)
            .attr('y', (height - padding.bottom) / 2)
            .attr('text-anchor', 'middle')
            .attr('transform', 'rotate(-90, -60, '+ (height - padding.bottom) / 2 + ')');

        if (plotAndDraw === false) {
          return;
        }

        // Draw circles.
        var animationDelay = 100;
        svg.selectAll('circle')  // Select all circles, and add data.
          .data(data)
          .enter()
          .append('circle')  // For each data, append a circle.
            .transition()
              .delay(function(d, i) { return i * animationDelay; })  // Delay append in ms.
              .duration(1000)  // Animation duration in ms.
            .attr('fill', 'white')
            .attr('cx', function(d) { return xAxis(d[0]); })  // x-coordinate.
            .attr('cy', function(d) { return yAxis(d[1]); })  // y-coordinate.
            .attr('r', radius);

        // Draw line.
        svg.append('line')
          .transition()
            .delay(data.length / 2 * animationDelay)
          .attr('x1', xAxis(8.0434)).attr('y1', yAxis(0))
          .attr('x2', xAxis(120)).attr('y2', yAxis(0.515 * 100))
          .attr('stroke', 'white')
          .attr('stroke-width', radius)
          .attr('class', 'best-fit');
      };

      function numberToEfficiencyGraph(container, plotAndDraw) {
        var width = 800,  // Width of <svg>.
            height = 500,  // Height of <svg>.
            padding = {top: 20, right: 50, bottom: 100, left: 100};  // Padding used for elements in <svg>.
            radius = 5;

        // Dataset.
        var x = [1, 3, 4, 5, 8, 9],
            y = [50, 68, 5, 4, 0, 13];
        var data = zip([x, y]);
        data = data.sort(function(a, b) {
          if (a[0] === b[0]) { return 0; }
          return (a[0] < b[0]) ? -1 : 1;
        });

        // For mapping the original values to coordinates.
        var xAxis = d3.scale.linear().domain([0, 10]).range([0 + padding.left, width - padding.right]),
            yAxis = d3.scale.linear().domain([80, 0]).range([0 + padding.top, height - padding.bottom]);

        // Remove and append new <svg>.
        d3.select(container).selectAll('svg').remove();
        var svg = d3.select(container)
          .append('svg')
          .attr('width', width)
          .attr('height', height);

        // Draw x-axis and y-axis.
        var xAxisLine = svg.append('g')
          .call(d3.svg.axis().scale(xAxis).ticks(10 / 1).orient('bottom'))
          .attr('class', 'axis')
          .attr('transform', 'translate(0, ' + (height - padding.bottom) + ')')
          .append('text')
            .text('average number of herons')
            .attr('x', width / 2)
            .attr('y', 70)
            .attr('text-anchor', 'middle');

        var yAxisLine = svg.append('g')
          .call(d3.svg.axis().scale(yAxis).ticks(80 / 10).orient('left'))
          .attr('class', 'axis')
          .attr('transform', 'translate(' + padding.left + ', 0)')
          .append('text')
            .text('foraging efficiency /%')
            .attr('x', -60)
            .attr('y', (height - padding.bottom) / 2)
            .attr('text-anchor', 'middle')
            .attr('transform', 'rotate(-90, -60, '+ (height - padding.bottom) / 2 + ')');

        if (plotAndDraw === false) {
          return;
        }

        // Draw circles.
        var animationDelay = 200;
        svg.selectAll('circle')  // Select all circles, and add data.
          .data(data)
          .enter()
          .append('circle')  // For each data, append a circle.
            .transition()
              .delay(function(d, i) { return i * animationDelay; })  // Delay append in ms.
              .duration(1000)  // Animation duration in ms.
            .attr('fill', 'white')
            .attr('cx', function(d) { return xAxis(d[0]); })  // x-coordinate.
            .attr('cy', function(d) { return yAxis(d[1]); })  // y-coordinate.
            .attr('r', radius);

        // Draw line.
        svg.append('line')
          .transition()
          .attr('x1', xAxis(0)).attr('y1', yAxis(0.546 * 100))
          .attr('x2', xAxis(8.667)).attr('y2', yAxis(0))
          .attr('stroke', 'white')
          .attr('stroke-width', radius)
          .attr('class', 'best-fit');
      }

      function tideLevels(container) {
        var width = 800,  // Width of <svg>.
            height = 500,  // Height of <svg>.
            padding = {top: 20, right: 50, bottom: 100, left: 120};  // Padding used for elements in <svg>.
            radius = 3;

        // Dataset.
        var data = [
          ['', [[0], []]],
          ['26 Feb', [[7*60 + 50, 100], [9*60 + 40, 150], [7*60 + 25, 90]], '0.7m @ 7:25'],
          ['28 Feb', [[7*60 + 25, 120], [10*60 + 45, 150], [8*60 + 25, 70]], '0.7m @ 8:25'],
          ['13 Mar', [[7*60 + 10, 120], [10*60 + 0, 150], [8*60 + 15, 30]], '0.3m @ 8:15'],
          ['16 Mar', [[10*60 + 0, 120], [11*60 + 30, 110], [10*60 + 55, 60]], '0.6m @ 10:55'],
          ['20 Mar', [[14*60 + 0, 140], [16*60 + 30, 70], [16*60 + 15, 65]], '0.5m @ 16:15'],
          [' ', [[0], []]]
        ];

        // For mapping the original values to coordinates.
        var xAxis = d3.scale.linear().domain([7*60, 17*60]).range([0 + padding.left, width - padding.right]),
            yAxis = d3.scale.ordinal()
              .domain(data.map(function(x) { return x[0]; }))
              .rangePoints([0 + padding.top, height - padding.bottom]);

        var tideHeight = (height - padding.bottom - padding.top) / (data.length - 1);
        var tideAxis = d3.scale.linear().domain([0, 150]).range([tideHeight, 0]);

        // Remove and append new <svg>.
        d3.select(container).selectAll('svg').remove();
        var svg = d3.select(container)
          .append('svg')
          .attr('width', width)
          .attr('height', height);

        // Draw x-axis and y-axis.
        var xAxisLine = svg.append('g')
          .call(d3.svg.axis()
              .scale(xAxis)
              .tickValues([420, 480, 540, 600, 660, 720, 780, 840, 900, 960, 1020])
              .tickFormat(function(d) { return (d / 60) + ''; })
              .orient('bottom'))
          .attr('class', 'axis')
          .attr('transform', 'translate(0, ' + (height - padding.bottom) + ')')
          .append('text')
            .text('time /:00')
            .attr('x', width / 2)
            .attr('y', 70)
            .attr('text-anchor', 'middle');

        var yAxisLine = svg.append('g')
          .call(d3.svg.axis().scale(yAxis).orient('left'))
          .attr('class', 'axis date-axis')
          .attr('transform', 'translate(' + padding.left + ', 0)');

        // Draw tide lines.
        var line = d3.svg.line()
          .interpolate('basis')
          .x(function(d, i) { return xAxis(d[0]); })
          .y(function(d, i) { return tideAxis(d[1]); })

        function sortAndSmoothen(c) {
          c = c.sort(function(a, b) {
            return a[0] < b[0];
          });
          c.splice(1, 0, [(c[0][0] + c[1][0]) / 2, c[0][1]]);
          c.splice(3, 0, [(c[2][0] + c[3][0]) / 2, c[3][1]]);
          return c;
        }

        var distAway = 10;
        data.forEach(function(item, i) {
          var g = svg.append('g')
            .attr('transform', 'translate(0, ' + i * tideHeight + ')')
          if (item[1][0][0] !== 0) {
            g.append('rect')
              .attr('width', width - padding.right - padding.left)
              .attr('height', tideHeight)
              .attr('transform', 'translate(' + padding.left + ', -10)')
              .attr('fill', i % 2 == 0 ? 'beige' : 'skyblue');
            var midPoint = item[1][2][0];  // Before sort and smoothen.
            var midPointY = item[1][2][1];
            if (midPoint > 13*60) {
              var cx = xAxis(item[1][2][0]) - distAway;
              var anchor = 'end';
            } else {
              var cx = xAxis(item[1][2][0]) + distAway;
              var anchor = 'start';
            }
            var path = g.append('path')
              .attr('d', line(sortAndSmoothen(item[1])))
              .attr('fill', 'none')
              .attr('stroke', 'blue')
              .attr('stroke-width', 8)
              .attr('class', 'tide');
            g.append('text')
              .text(item[2])
              .attr('text-anchor', anchor)
              .attr('class', 'tide-text')
              .attr('transform', 'translate(' + cx + ', ' + tideHeight * 0.75 + ')');
            g.append('rect')
              .attr('width', 3)
              .attr('height', tideHeight)
              .attr('transform', 'translate(' + xAxis(midPoint) + ', -10)')
              .attr('fill', 'darkblue');
          }
        });
      }

      function drawDistanceLine(container) {
        d3.select(container).selectAll('svg').remove();
        var svg = d3.select(container).append('svg').attr('class', 'svg-overlay');
        svg.append('marker')
          .attr({
            'id': 'triangle',
            'viewBox': '0 0 10 10',
            'refX': 0,
            'refY': 5,
            'markerWidth': 4,
            'markerHeight': 3,
            'orient': 'auto'
          })
          .append('path')
            .attr('d', 'M 0 0 L 10 5 L 0 10 z');

        svg.append('line')
          .attr({
            'x1': '48.5%',
            'y1': '67%',
            'x2': '48.5%',
            'y2': '67%',
            'marker-end': 'url(#triangle)'
          })
          .transition()
            .duration(2500)
            .attr('x2', '58%')
            .attr('y2', '52%');
        svg.append('line')
          .attr({
            'x1': '48.5%',
            'y1': '67%',
            'x2': '48.5%',
            'y2': '67%',
            'marker-end': 'url(#triangle)'
          })
          .transition()
            .duration(2500)
            .attr('x2', '39%')
            .attr('y2', '82%');
      }

      Reveal.addEventListener('slidechanged', function(event) {
        var currSlide = d3.select(event.currentSlide);
        if (event.currentSlide.id === 'scene5') {
          tideLevels(d3.select(event.currentSlide).select('.anything')[0][0]);
        }
        if (event.currentSlide.id === 'scene11') {
          currSlide.select('i').remove();
          distToEfficiencyGraph(d3.select(event.currentSlide).select('.anything')[0][0], false);
          currSlide.append('i').attr('class', 'fragment').attr('data-slide-id', 'scene11');
        }
        if (event.currentSlide.id === 'scene11a') {
          currSlide.select('i').remove();
          numberToEfficiencyGraph(d3.select(event.currentSlide).select('.anything')[0][0], false);
          currSlide.append('i').attr('class', 'fragment').attr('data-slide-id', 'scene11a');
        }
        if (event.currentSlide.id === 'scene4') {
          currSlide.selectAll('g').attr('class', '');
          var svg = currSlide.selectAll('svg').remove();
          currSlide.append(function() {
            return svg.node();
          });
          setTimeout(function() {
            currSlide.selectAll('g').attr('class', 'opaque');
          }, 1000);
        }
        if (event.currentSlide.id === 'scene9') {
          drawDistanceLine(d3.select(event.currentSlide).select('.anything')[0][0]);
        }
        if (currSlide.classed('has-svg-overlay')) {
          var svg = currSlide.selectAll('svg').remove();
            currSlide.append(function() {
              return svg.node();
            });
        }
      });

      Reveal.addEventListener('fragmentshown', function(event) {
        var currSlide = event.fragment.dataset.slideId;
        if (currSlide === 'scene11') {
          distToEfficiencyGraph(d3.select('#' + currSlide).select('.anything')[0][0]);
        }
        if (currSlide === 'scene11a') {
          numberToEfficiencyGraph(d3.select('#' + currSlide).select('.anything')[0][0]);
        }
      });

      Reveal.addEventListener('fragmenthidden', function(event) {
        var currSlide = event.fragment.dataset.slideId;
        console.log(currSlide);
        if (currSlide === 'scene11') {
          distToEfficiencyGraph(d3.select('#' + currSlide).select('.anything')[0][0], false);
        }
        if (currSlide === 'scene11a') {
          numberToEfficiencyGraph(d3.select('#' + currSlide).select('.anything')[0][0], false);
        }
      });
    </script>
  </body>
</html>
